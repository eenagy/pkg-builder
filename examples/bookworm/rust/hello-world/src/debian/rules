#!/usr/bin/make -f

export CARGO_INSTALL_EXTRA_FLAGS:=--root build
export RUST_VERSION:=1.76.0
export PATH:="$(HOME)/.cargo/bin:$(PATH)"
export PROFILE:=release
export FEATURES:=jemalloc


%:
	cd /tmp && curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain $(RUST_VERSION)
	dh $@


override_dh_auto_build:
	$(HOME)/.cargo/bin/cargo install --path . --force --locked \
		--features "$(FEATURES)" \
		--profile "$(PROFILE)" \
		$(CARGO_INSTALL_EXTRA_FLAGS)

override_dh_auto_test:
	cp /tmp/anvil $(HOME)/.cargo/bin
	$(HOME)/.cargo/bin/cargo test --release


override_dh_auto_install:

override_dh_installsystemd:


override_dh_dwz:

